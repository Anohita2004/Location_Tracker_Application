This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.js
index.html
package.json
public/vite.svg
README.md
server/index.js
src/App.css
src/App.jsx
src/assets/react.svg
src/index.css
src/main.jsx
src/MapComponent.jsx
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>location-tracker</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "location-tracker",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview",
    "server": "node server/index.js"
  },
  "dependencies": {
    "@react-google-maps/api": "^2.20.8",
    "axios": "^1.13.2",
    "cors": "^2.8.5",
    "dotenv": "^17.2.3",
    "express": "^5.2.1",
    "lucide-react": "^0.562.0",
    "nodemon": "^3.1.11",
    "pg": "^8.16.3",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "socket.io": "^4.8.3",
    "socket.io-client": "^4.8.3"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.4"
  }
}
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="README.md">
# Location Tracker Application

## Overview
A live location tracking application designed for mobile devices. Users can sign up/login with their mobile number, authenticate via OTP, and immediately start broadcasting their location to a central map. The map also displays other registered devices (e.g., trucks/fleet).

## Features
- **Mobile-First Design**: Optimized for mobile usage.
- **OTP Login**: Secure entry using mobile number and OTP.
- **Auto-Registration**: Device location and details are registered automatically upon login.
- **Live Tracking**: Real-time location updates using WebSockets.
- **Interactive Map**: Google Maps integration with dark mode/premium styling.

## Prerequisites
- Node.js installed.
- Google Maps API Key (for full map functionality).

## Setup & Run

1.  **Install Dependencies**
    ```bash
    npm install
    ```

2.  **Configuration**
    - Open `src/MapComponent.jsx`.
    - Find `googleMapsApiKey: ""` and insert your Google Maps API Key.
    - *Note: Without a key, the map will display in "Development Mode" (darkened with watermark).*

3.  **Run the Application**
    You need to run both the Backend (server) and Frontend (client).

    **Terminal 1 (Backend):**
    ```bash
    npm run server
    ```
    *Runs on port 3000.*

    **Terminal 2 (Frontend):**
    ```bash
    npm run dev
    ```
    *Runs on http://localhost:5173.*

4.  **How to Test**
    - Open `http://localhost:5173` in your browser (or use mobile network IP).
    - **Login**: Enter any 10-digit mobile number (e.g., `9000000000`).
    - **OTP**: Enter code `1234` (Mock OTP).
    - **Permission**: Allow Location Access when prompted by the browser.
    - **View**: You will see your location and 5-6 simulated trucks on the map.
</file>

<file path="server/index.js">
import express from 'express';
import http from 'http';
import { Server } from 'socket.io';
import cors from 'cors';
import pg from 'pg';
import dotenv from 'dotenv';

dotenv.config();

const { Pool } = pg;
const app = express();
app.use(cors());
app.use(express.json());

const server = http.createServer(app);
const io = new Server(server, {
    cors: {
        origin: "*",
        methods: ["GET", "POST"]
    }
});

// Database Connection
const pool = new Pool({
    user: process.env.DB_USER || 'postgres',
    host: process.env.DB_HOST || 'localhost',
    database: process.env.DB_DATABASE || 'location_tracker',
    password: process.env.DB_PASSWORD || 'password',
    port: process.env.DB_PORT || 5432,
});

// Initialize DB and Seed Data
const initDB = async () => {
    try {
        await pool.query(`
            CREATE TABLE IF NOT EXISTS devices (
                mobile VARCHAR(20) PRIMARY KEY,
                lat DOUBLE PRECISION,
                lng DOUBLE PRECISION,
                last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );
        `);

        await pool.query(`
            CREATE TABLE IF NOT EXISTS location_history (
                id SERIAL PRIMARY KEY,
                mobile VARCHAR(20),
                lat DOUBLE PRECISION,
                lng DOUBLE PRECISION,
                timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );
        `);
        console.log("Database tables 'devices' and 'location_history' ready.");

        // Check if we need to seed demo data
        // User requested "demo entries" for North/South/East/West features
        // Check if demo data exists (check for North-Truck-1)
        const res = await pool.query("SELECT * FROM devices WHERE mobile = 'North-Truck-1'");
        if (res.rows.length === 0) { // Seed if demo truck missing
            console.log("Seeding regional demo data...");
            const seedQueries = [
                // North (Delhi area)
                `INSERT INTO devices (mobile, lat, lng) VALUES ('North-Truck-1', 28.7041, 77.1025)`,
                `INSERT INTO devices (mobile, lat, lng) VALUES ('North-Truck-2', 30.7333, 76.7794)`, // Chandigarh

                // South (Bangalore/Chennai)
                `INSERT INTO devices (mobile, lat, lng) VALUES ('South-Truck-1', 12.9716, 77.5946)`,
                `INSERT INTO devices (mobile, lat, lng) VALUES ('South-Truck-2', 13.0827, 80.2707)`,

                // East (Kolkata)
                `INSERT INTO devices (mobile, lat, lng) VALUES ('East-Truck-1', 22.5726, 88.3639)`,
                `INSERT INTO devices (mobile, lat, lng) VALUES ('East-Truck-2', 26.1445, 91.7362)`, // Guwahati

                // West (Mumbai/Pune)
                `INSERT INTO devices (mobile, lat, lng) VALUES ('West-Truck-1', 19.0760, 72.8777)`,
                `INSERT INTO devices (mobile, lat, lng) VALUES ('West-Truck-2', 18.5204, 73.8567)`
            ];
            for (let q of seedQueries) {
                await pool.query(q);
            }
            // Seed history for demo trucks so date filter works for them too (optional but good)
        }
        console.log(`Database ready.`);
    } catch (err) {
        console.error("Database Initialization Error:", err.message);
        console.log("HINT: Make sure PostgreSQL is running and you have created the database specified in .env");
    }
};

initDB();

io.on('connection', async (socket) => {
    // Send current data from DB
    try {
        const res = await pool.query('SELECT * FROM devices');
        socket.emit('initial-data', res.rows);
    } catch (err) {
        console.error("Error fetching initial data", err);
    }

    socket.on('disconnect', () => {
        // console.log('Client disconnected');
    });
});

app.post('/api/login', (req, res) => {
    const { mobile } = req.body;
    console.log(`OTP requested for ${mobile}`);
    // In a real app, generate and save OTP here
    res.json({ success: true, message: 'OTP sent to mobile' });
});

app.get('/api/history', async (req, res) => {
    const { mobile, date } = req.query;
    if (!mobile || !date) return res.status(400).json({ error: 'Missing mobile or date' });

    try {
        // Query for records on that specific date
        // Assuming 'date' string is YYYY-MM-DD
        const query = `
            SELECT * FROM location_history 
            WHERE mobile = $1 
            AND date_trunc('day', timestamp) = $2::date
            ORDER BY timestamp DESC
        `;
        const result = await pool.query(query, [mobile, date]);
        res.json({ success: true, history: result.rows });
    } catch (err) {
        console.error(err);
        res.status(500).json({ error: 'Database error' });
    }
});

app.post('/api/verify-otp', async (req, res) => {
    const { mobile, otp } = req.body;

    if (otp === '1234') {
        try {
            // Check if user exists, if not create
            const checkRes = await pool.query('SELECT * FROM devices WHERE mobile = $1', [mobile]);
            let user = checkRes.rows[0];

            if (!user) {
                await pool.query('INSERT INTO devices (mobile, last_updated) VALUES ($1, NOW())', [mobile]);
                user = { mobile, lat: null, lng: null, last_updated: new Date() };
            }

            res.json({ success: true, user });
        } catch (err) {
            console.error(err);
            res.status(500).json({ success: false, message: 'Database error' });
        }
    } else {
        res.status(400).json({ success: false, message: 'Invalid OTP' });
    }
});

app.post('/api/update-location', async (req, res) => {
    const { mobile, lat, lng } = req.body;
    if (!mobile || !lat || !lng) return res.status(400).json({ error: 'Missing data' });

    try {
        // 1. Update latest device location
        const query = `
          INSERT INTO devices (mobile, lat, lng, last_updated)
          VALUES ($1, $2, $3, NOW())
          ON CONFLICT (mobile) 
          DO UPDATE SET lat = EXCLUDED.lat, lng = EXCLUDED.lng, last_updated = NOW()
          RETURNING *;
      `;
        const result = await pool.query(query, [mobile, lat, lng]);
        const updatedUser = result.rows[0];

        // 2. Log to history
        await pool.query('INSERT INTO location_history (mobile, lat, lng, timestamp) VALUES ($1, $2, $3, NOW())', [mobile, lat, lng]);

        // Broadcast update to all connected clients
        io.emit('location-update', updatedUser);
        res.json({ success: true });
    } catch (err) {
        console.error(err);
        res.status(500).json({ error: 'Database error' });
    }
});

const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
    console.log(`Backend Server running on port ${PORT}`);
});
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.jsx">
import React, { useState, useEffect, useMemo } from 'react';
import io from 'socket.io-client';
import axios from 'axios';
import MapComponent from './MapComponent';
import { Menu, X, Navigation, Truck, User, Calendar, LogOut } from 'lucide-react';

// Initialize socket connection to backend
const socket = io('http://localhost:3000');

function App() {
  const [step, setStep] = useState('loading'); // 'loading', 'login', 'otp', 'map'
  const [mobile, setMobile] = useState('');
  const [otp, setOtp] = useState('');
  const [users, setUsers] = useState([]);
  const [currentUser, setCurrentUser] = useState(null);
  const [error, setError] = useState('');

  // Sidebar & Navigation State
  const [isSidebarOpen, setSidebarOpen] = useState(false);
  const [selectedDevice, setSelectedDevice] = useState(null);
  const [selectedDate, setSelectedDate] = useState('');
  const [historyPoints, setHistoryPoints] = useState([]);

  // Check for saved session on mount
  useEffect(() => {
    const savedUser = localStorage.getItem('tracker_user');
    if (savedUser) {
      try {
        const userFn = JSON.parse(savedUser);
        if (userFn && userFn.mobile) {
          setCurrentUser(userFn);
          setStep('map');
        } else {
          setStep('login');
        }
      } catch (e) {
        setStep('login');
      }
    } else {
      setStep('login');
    }
  }, []);

  // Group Users by Region
  const groupedUsers = useMemo(() => {
    const groups = { North: [], South: [], East: [], West: [] };
    users.forEach(u => {
      if (u.mobile === currentUser?.mobile) return;
      if (u.lat >= 22) {
        if (u.lng < 79) groups.North.push(u);
        else groups.East.push(u);
      } else {
        if (u.lng < 76) groups.West.push(u);
        else if (u.lng > 85) groups.East.push(u);
        else groups.South.push(u);
      }
    });
    users.forEach(u => {
      if (u.mobile.startsWith('North')) { if (!groups.North.includes(u)) groups.North.push(u); }
      else if (u.mobile.startsWith('South')) { if (!groups.South.includes(u)) groups.South.push(u); }
      else if (u.mobile.startsWith('East')) { if (!groups.East.includes(u)) groups.East.push(u); }
      else if (u.mobile.startsWith('West')) { if (!groups.West.includes(u)) groups.West.push(u); }
    });
    Object.keys(groups).forEach(k => {
      const seen = new Set();
      groups[k] = groups[k].filter(item => {
        const curr = item.mobile;
        if (seen.has(curr)) return false;
        seen.add(curr);
        return true;
      });
    });
    return groups;
  }, [users, currentUser]);


  // Socket: Listen for updates
  useEffect(() => {
    socket.on('initial-data', (data) => {
      setUsers(data);
    });
    socket.on('location-update', (updatedUser) => {
      setUsers(prev => {
        const idx = prev.findIndex(u => u.mobile === updatedUser.mobile);
        if (idx > -1) {
          const newUsers = [...prev];
          newUsers[idx] = updatedUser;
          return newUsers;
        } else {
          return [...prev, updatedUser];
        }
      });
    });
    return () => {
      socket.off('initial-data');
      socket.off('location-update');
    };
  }, []);

  // Fetch History
  useEffect(() => {
    if (currentUser && selectedDate) {
      axios.get(`http://localhost:3000/api/history?mobile=${currentUser.mobile}&date=${selectedDate}`)
        .then(res => {
          setHistoryPoints(res.data.history);
          if (res.data.history.length === 0) {
            setError('No location history found for this date');
          } else {
            setSidebarOpen(false);
          }
        })
        .catch(err => console.error(err));
    } else {
      setHistoryPoints([]);
    }
  }, [selectedDate, currentUser]);

  // Geolocation
  useEffect(() => {
    if (step === 'map' && currentUser) {
      const watchId = navigator.geolocation.watchPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          axios.post('http://localhost:3000/api/update-location', {
            mobile: currentUser.mobile,
            lat: latitude,
            lng: longitude
          }).catch(err => console.error('Error updating location:', err));
        },
        (err) => console.error('Geolocation error:', err),
        { enableHighAccuracy: true, timeout: 20000, maximumAge: 1000 }
      );
      return () => navigator.geolocation.clearWatch(watchId);
    }
  }, [step, currentUser]);

  const handleLogin = async (e) => {
    e.preventDefault();
    if (mobile.length < 1) {
      setError('Please enter a mobile number');
      return;
    }
    setError('');
    try {
      await axios.post('http://localhost:3000/api/login', { mobile });
      setStep('otp');
    } catch (err) {
      setError('Login failed.');
    }
  };

  const handleVerifyOtp = async (e) => {
    e.preventDefault();
    setError('');
    try {
      const res = await axios.post('http://localhost:3000/api/verify-otp', { mobile, otp });
      if (res.data.success) {
        const user = res.data.user;
        setCurrentUser(user);
        setStep('map');
        localStorage.setItem('tracker_user', JSON.stringify(user));
      }
    } catch (err) {
      setError('Invalid OTP');
    }
  }

  const handleLogout = () => {
    localStorage.removeItem('tracker_user');
    setCurrentUser(null);
    setStep('login');
    setSidebarOpen(false);
    setMobile('');
    setOtp('');
  };

  if (step === 'loading') {
    return <div className="loading-spinner" style={{ marginTop: '40vh' }}></div>
  }

  return (
    <div style={{ height: '100%', width: '100%' }}>
      {step === 'login' && (
        <div className="login-container">
          <div className="glass-panel login-card animate-fade-in">
            <h1>ðŸš› Live Tracker</h1>
            <p>Enter mobile to start</p>
            <form onSubmit={handleLogin}>
              <input className="input-field" type="text" placeholder="Mobile" value={mobile} onChange={e => setMobile(e.target.value)} />
              {error && <p style={{ color: '#ef4444' }}>{error}</p>}
              <button className="btn-primary">Get OTP</button>
            </form>
          </div>
        </div>
      )}

      {step === 'otp' && (
        <div className="login-container">
          <div className="glass-panel login-card animate-fade-in">
            <h1>Verify OTP</h1>
            <p>Code sent to {mobile}</p>
            <form onSubmit={handleVerifyOtp}>
              <input className="input-field" type="text" placeholder="OTP (1234)" value={otp} onChange={e => setOtp(e.target.value)} autoFocus />
              {error && <p style={{ color: '#ef4444' }}>{error}</p>}
              <button className="btn-primary">Verify</button>
            </form>
            <button onClick={() => setStep('login')} style={{ background: 'none', border: 'none', color: 'var(--text-sub)', marginTop: 20 }}>Back</button>
          </div>
        </div>
      )}

      {step === 'map' && (
        <div className="map-container animate-fade-in">
          <button className="toggle-btn" onClick={() => setSidebarOpen(!isSidebarOpen)}>
            {isSidebarOpen ? <X size={24} /> : <Menu size={24} />}
          </button>

          <div className={`sidebar glass-panel ${isSidebarOpen ? 'open' : ''}`}>
            <div className="sidebar-header">
              <h2><User size={20} /> {currentUser?.mobile}</h2>
              <button onClick={handleLogout} style={{ background: 'none', border: '1px solid var(--glass-border)', padding: 6 }}><LogOut size={16} /></button>
            </div>

            <div style={{ padding: 16, borderBottom: '1px solid var(--glass-border)' }}>
              <div style={{ display: 'flex', gap: 10, marginBottom: 10 }}><Calendar size={18} /> HISTORY</div>
              <input type="date" className="input-field" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} />
            </div>

            <div className="sidebar-content">
              {Object.entries(groupedUsers).map(([region, regionUsers]) => (
                <div key={region} className="menu-category">
                  <div className="category-title">{region} Region</div>
                  {regionUsers.map(u => {
                    const isSelected = selectedDevice?.mobile === u.mobile;
                    return (
                      <div key={u.mobile} className={`device-item ${isSelected ? 'active' : ''}`} onClick={() => isSelected ? setSelectedDevice(null) : setSelectedDevice(u)} style={{ display: 'flex', alignItems: 'center' }}>
                        <div style={{ width: 18, height: 18, border: isSelected ? 'none' : '2px solid gray', borderRadius: 4, background: isSelected ? 'var(--primary)' : 'transparent', marginRight: 12, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                          {isSelected && <span style={{ color: 'white', fontSize: 12 }}>âœ“</span>}
                        </div>
                        <Truck size={18} />
                        <span style={{ marginLeft: 8 }}>{u.mobile}</span>
                      </div>
                    );
                  })}
                </div>
              ))}
            </div>
          </div>

          <MapComponent users={users} currentUserMobile={currentUser?.mobile} destinationUser={selectedDevice} historyPoints={historyPoints} />

          {selectedDate && (
            <div style={{ position: 'absolute', top: 80, left: '50%', transform: 'translateX(-50%)', background: 'var(--card-bg)', padding: '8px 16px', borderRadius: 30, color: 'var(--primary)' }}>
              History: {selectedDate}
            </div>
          )}
        </div>
      )}
    </div>
  );
}

export default App;
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/index.css">
:root {
  --bg-color: #0f172a;
  --card-bg: rgba(30, 41, 59, 0.7);
  --primary: #3b82f6;
  --accent: #10b981;
  --text-main: #f8fafc;
  --text-sub: #94a3b8;
  --glass-border: rgba(255, 255, 255, 0.1);
}

body {
  margin: 0;
  padding: 0;
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  background-color: var(--bg-color);
  color: var(--text-main);
  overflow-x: hidden;
}

#root {
  height: 100vh;
  width: 100vw;
  display: flex;
  flex-direction: column;
}

/* Utilities */
.glass-panel {
  background: var(--card-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), #2563eb);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  width: 100%;
  font-size: 1rem;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px -10px var(--primary);
}

.input-field {
  width: 100%;
  padding: 16px;
  background: rgba(15, 23, 42, 0.5);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  color: white;
  font-size: 1.1rem;
  outline: none;
  transition: border-color 0.2s;
  box-sizing: border-box;
  /* Important for width 100% */
}

.input-field:focus {
  border-color: var(--primary);
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fadeIn 0.5s ease-out forwards;
}

/* Layouts */
.login-container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%;
  padding: 24px;
  background: radial-gradient(circle at top right, #1e293b, #0f172a);
}

.login-card {
  width: 100%;
  max-width: 400px;
  padding: 40px;
  text-align: center;
}

.map-container {
  flex: 1;
  width: 100%;
  height: 100%;
  position: relative;
}

.overlay-status {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 24px;
  border-radius: 30px;
  background: rgba(16, 185, 129, 0.2);
  border: 1px solid #10b981;
  color: #10b981;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 10;
}

.loading-spinner {
  border: 4px solid rgba(255, 255, 255, 0.1);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border-left-color: var(--primary);
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

/* Sidebar */
.sidebar {
  position: absolute;
  top: 0;
  left: 0;
  height: 100vh;
  width: 280px;
  background: rgba(15, 23, 42, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-right: 1px solid var(--glass-border);
  transform: translateX(-100%);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1000;
  display: flex;
  flex-direction: column;
  box-shadow: 4px 0 24px rgba(0, 0, 0, 0.5);
}

.sidebar.open {
  transform: translateX(0);
}

.sidebar-header {
  padding: 24px;
  border-bottom: 1px solid var(--glass-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.sidebar-content {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
}

.menu-category {
  margin-bottom: 24px;
}

.category-title {
  font-size: 0.85rem;
  font-weight: 700;
  text-transform: uppercase;
  color: var(--primary);
  margin-bottom: 12px;
  letter-spacing: 1.2px;
  padding-left: 8px;
}

.device-item {
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 6px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 12px;
  border: 1px solid transparent;
}

.device-item:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(255, 255, 255, 0.1);
}

.device-item.active {
  background: rgba(59, 130, 246, 0.15);
  border-color: var(--primary);
  color: var(--primary);
}

.toggle-btn {
  position: absolute;
  top: 20px;
  left: 20px;
  z-index: 100;
  background: var(--card-bg);
  border: 1px solid var(--glass-border);
  color: white;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  cursor: pointer;
  backdrop-filter: blur(4px);
  transition: all 0.2s;
}

.toggle-btn:hover {
  background: var(--primary);
  border-color: var(--primary);
}
</file>

<file path="src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="src/MapComponent.jsx">
import React, { useState, useEffect } from 'react';
import { GoogleMap, useJsApiLoader, Marker, Polyline } from '@react-google-maps/api';

const containerStyle = {
    width: '100%',
    height: '100%'
};

const center = {
    lat: 20.5937,
    lng: 78.9629
};

const darkMapStyle = [
    { elementType: "geometry", stylers: [{ color: "#242f3e" }] },
    { elementType: "labels.text.stroke", stylers: [{ color: "#242f3e" }] },
    { elementType: "labels.text.fill", stylers: [{ color: "#746855" }] },
    {
        featureType: "administrative.locality",
        elementType: "labels.text.fill",
        stylers: [{ color: "#d59563" }],
    },
    {
        featureType: "poi",
        elementType: "labels.text.fill",
        stylers: [{ color: "#d59563" }],
    },
    {
        featureType: "poi.park",
        elementType: "geometry",
        stylers: [{ color: "#263c3f" }],
    },
    {
        featureType: "poi.park",
        elementType: "labels.text.fill",
        stylers: [{ color: "#6b9a76" }],
    },
    {
        featureType: "road",
        elementType: "geometry",
        stylers: [{ color: "#38414e" }],
    },
    {
        featureType: "road",
        elementType: "geometry.stroke",
        stylers: [{ color: "#212a37" }],
    },
    {
        featureType: "road",
        elementType: "labels.text.fill",
        stylers: [{ color: "#9ca5b3" }],
    },
    {
        featureType: "road.highway",
        elementType: "geometry",
        stylers: [{ color: "#746855" }],
    },
    {
        featureType: "road.highway",
        elementType: "geometry.stroke",
        stylers: [{ color: "#1f2835" }],
    },
    {
        featureType: "road.highway",
        elementType: "labels.text.fill",
        stylers: [{ color: "#f3d19c" }],
    },
    {
        featureType: "water",
        elementType: "geometry",
        stylers: [{ color: "#17263c" }],
    },
    {
        featureType: "water",
        elementType: "labels.text.fill",
        stylers: [{ color: "#515c6d" }],
    },
    {
        featureType: "water",
        elementType: "labels.text.stroke",
        stylers: [{ color: "#17263c" }],
    },
];

function MapComponent({ users, currentUserMobile, destinationUser, historyPoints = [] }) {
    const { isLoaded } = useJsApiLoader({
        id: 'google-map-script',
        googleMapsApiKey: ""
    });

    const [map, setMap] = React.useState(null);

    const onLoad = React.useCallback(function callback(map) {
        setMap(map);
    }, []);

    const onUnmount = React.useCallback(function callback(map) {
        setMap(null);
    }, []);

    // Center on user: Initially, OR when navigation/history is cleared
    useEffect(() => {
        // Only center if NO destination and NO history is active
        if (map && currentUserMobile && !destinationUser && users.length > 0 && historyPoints.length === 0) {
            const currentUser = users.find(u => u.mobile === currentUserMobile);
            if (currentUser?.lat) {
                map.panTo({ lat: currentUser.lat, lng: currentUser.lng });
                // Reset zoom to street level (15) to "unview" the route view
                map.setZoom(15);
            }
        }
    }, [users, currentUserMobile, map, destinationUser, historyPoints]);

    // Fit bounds if route active or history
    useEffect(() => {
        if (map && historyPoints.length > 0) {
            const bounds = new window.google.maps.LatLngBounds();
            historyPoints.forEach(pt => bounds.extend({ lat: pt.lat, lng: pt.lng }));
            map.fitBounds(bounds);
        } else if (map && currentUserMobile && destinationUser && users.length > 0) {
            const currentUser = users.find(u => u.mobile === currentUserMobile);
            if (currentUser?.lat && destinationUser?.lat) {
                const bounds = new window.google.maps.LatLngBounds();
                bounds.extend({ lat: currentUser.lat, lng: currentUser.lng });
                bounds.extend({ lat: destinationUser.lat, lng: destinationUser.lng });
                map.fitBounds(bounds);
            }
        }
    }, [destinationUser, currentUserMobile, users, map, historyPoints]);

    if (!isLoaded) return <div className="loading-spinner"></div>;

    const currentUser = users.find(u => u.mobile === currentUserMobile);
    const routePath = (currentUser && destinationUser) ? [
        { lat: currentUser.lat, lng: currentUser.lng },
        { lat: destinationUser.lat, lng: destinationUser.lng }
    ] : [];

    // Convert history points to path
    const historyPath = historyPoints.map(pt => ({ lat: pt.lat, lng: pt.lng }));

    return (
        <GoogleMap
            mapContainerStyle={containerStyle}
            center={center}
            zoom={5}
            onLoad={onLoad}
            onUnmount={onUnmount}
            options={{
                styles: darkMapStyle,
                disableDefaultUI: false,
                zoomControl: true,
            }}
        >
            {/* Live Users - Other Trucks */}
            {historyPoints.length === 0 && users.map(user => {
                if (!user.lat || !user.lng) return null;
                // Don't render "Me" here, I'll do it separately to be safe and clear
                if (user.mobile === currentUserMobile) return null;

                const isDestination = destinationUser?.mobile === user.mobile;

                return (
                    <Marker
                        key={user.mobile}
                        position={{ lat: user.lat, lng: user.lng }}
                        title={`User: ${user.mobile}`}
                        label={{
                            text: isDestination ? "ðŸŽ¯" : "ðŸš›",
                            color: "white",
                            fontSize: "14px"
                        }}
                    />
                )
            })}

            {/* Current User Marker - Always Show if Location Available */}
            {(() => {
                const me = users.find(u => u.mobile === currentUserMobile);
                if (me && me.lat && me.lng && historyPoints.length === 0) {
                    return (
                        <Marker
                            position={{ lat: me.lat, lng: me.lng }}
                            title="Me"
                            options={{
                                icon: {
                                    path: window.google.maps.SymbolPath.CIRCLE,
                                    scale: 10,
                                    fillColor: "#3b82f6",
                                    fillOpacity: 1,
                                    strokeColor: "white",
                                    strokeWeight: 2,
                                }
                            }}
                        />
                    )
                }
                return null;
            })()}

            {/* Route Line - only if destination is picked and has coordinates */}
            {destinationUser && currentUser && currentUser.lat && destinationUser.lat && (
                <Polyline
                    key={`route-line-${destinationUser.mobile}`}
                    path={[
                        { lat: currentUser.lat, lng: currentUser.lng },
                        { lat: destinationUser.lat, lng: destinationUser.lng }
                    ]}
                    options={{
                        strokeColor: "#3b82f6",
                        strokeOpacity: 0.8,
                        strokeWeight: 4,
                        geodesic: true,
                        icons: [{
                            icon: { path: window.google.maps.SymbolPath.FORWARD_CLOSED_ARROW },
                            offset: '100%'
                        }]
                    }}
                />
            )}

            {/* History Path */}
            {historyPath.length > 0 && (
                <>
                    <Polyline
                        path={historyPath}
                        options={{
                            strokeColor: "#10b981", // Green for history
                            strokeOpacity: 0.8,
                            strokeWeight: 4,
                        }}
                    />
                    {historyPoints.map((pt, i) => (
                        <Marker
                            key={i}
                            position={{ lat: pt.lat, lng: pt.lng }}
                            options={{
                                icon: {
                                    path: window.google.maps.SymbolPath.CIRCLE,
                                    scale: 5,
                                    fillColor: "#10b981",
                                    fillOpacity: 1,
                                    strokeColor: "white",
                                    strokeWeight: 1,
                                }
                            }}
                        />
                    ))}
                </>
            )}
        </GoogleMap>
    )
}

export default React.memo(MapComponent)
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

</files>
